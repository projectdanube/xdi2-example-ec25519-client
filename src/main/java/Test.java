
import java.util.Arrays;

import org.abstractj.kalium.NaCl;
import org.abstractj.kalium.NaCl.Sodium;
import org.abstractj.kalium.encoders.Hex;

import jnr.ffi.byref.LongLongByReference;

public class Test {

	public static void one() throws Exception {
		
		String pubs = "bae9e2c6ce1d9e8c2ac2fa31aa2a20c5d7e9766d76e60aeab739dede9a1bb79f";
		String sigs = "3c1f4caf17cec1ccac20d9b185215348f4d72f0f7020fadc0ce5933f527125dea5e7c90172abed951e0e990bfe133389a7246fc3489494a5413e08d455fc3b01";
		String msgs = "7b222f223a5b22283d213a757569643a3232323229222c22283d213a757569643a323232322f247465737429222c223d213a7075626c69636b65792d637572766532353531392d6261736535382d636865636b3a75756e69787334646e6f777177766f7871696f6778646670646d313235677271747a6e6533706f62743538222c223d213a757569643a32323232225d2c223d213a757569643a323232322f2474657374223a5b7b222f223a5b2224646f225d7d2c22283d213a757569643a323232322f247465737429225d2c223d213a7075626c69636b65792d637572766532353531392d6261736535382d636865636b3a75756e69787334646e6f777177766f7871696f6778646670646d313235677271747a6e6533706f627435382f223a5b225b246d73675d225d2c223d213a7075626c69636b65792d637572766532353531392d6261736535382d636865636b3a75756e69787334646e6f777177766f7871696f6778646670646d313235677271747a6e6533706f627435385b246d73675d2f223a5b222a213a757569643a32313166363836612d313230632d343939652d623137372d393037303163383138613161225d2c223d213a7075626c69636b65792d637572766532353531392d6261736535382d636865636b3a75756e69787334646e6f777177766f7871696f6778646670646d313235677271747a6e6533706f627435385b246d73675d2a213a757569643a32313166363836612d313230632d343939652d623137372d3930373031633831386131612f223a5b2224646f225d2c223d213a7075626c69636b65792d637572766532353531392d6261736535382d636865636b3a75756e69787334646e6f777177766f7871696f6778646670646d313235677271747a6e6533706f627435385b246d73675d2a213a757569643a32313166363836612d313230632d343939652d623137372d3930373031633831386131612f24646f223a5b22283d213a757569643a323232322f24746573742924646f225d2c223d213a7075626c69636b65792d637572766532353531392d6261736535382d636865636b3a75756e69787334646e6f777177766f7871696f6778646670646d313235677271747a6e6533706f627435385b246d73675d2a213a757569643a32313166363836612d313230632d343939652d623137372d3930373031633831386131612f2469732829223a5b22283d213a757569643a3232323229225d2c223d213a7075626c69636b65792d637572766532353531392d6261736535382d636865636b3a75756e69787334646e6f777177766f7871696f6778646670646d313235677271747a6e6533706f627435385b246d73675d2a213a757569643a32313166363836612d313230632d343939652d623137372d39303730316338313861316124646f2f24676574223a5b22225d7d";

		byte[] msg = Hex.HEX.decode(msgs);
		System.out.println("normalized msg: " + new String(Hex.HEX.encode(msg)));

		byte[] sig = Hex.HEX.decode(sigs);
		System.out.println("sig: " + new String(Hex.HEX.encode(sig)));

		byte[] pub = Hex.HEX.decode(pubs);
		System.out.println("pub: " + new String(Hex.HEX.encode(pub)));
		
		byte[] sigAndMsg = new byte[sig.length + msg.length];
		System.arraycopy(sig, 0, sigAndMsg, 0, sig.length);
		System.arraycopy(msg, 0, sigAndMsg, sig.length, msg.length);

		byte[] buffer = new byte[sigAndMsg.length];
		LongLongByReference bufferLen = new LongLongByReference();

		int ret = NaCl.sodium().crypto_sign_ed25519_open(buffer, bufferLen, sigAndMsg, sigAndMsg.length, pub);
		if (ret != 0) throw new RuntimeException("Crypto error.");

		buffer = Arrays.copyOf(buffer, buffer.length - Sodium.SIGNATURE_BYTES);
		if (! Arrays.equals(msg, buffer)) throw new RuntimeException("Crypto error.");
	}
	
	public static void main(String[] args) throws Exception {

		one();
	}
}
